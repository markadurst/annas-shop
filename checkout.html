<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Anna's Sweet Crafts</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Comic+Neue:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <img src="images/logo.jpg" alt="Anna's Sweet Crafts Logo" class="logo-img">
                <h1>Anna's Sweet Crafts</h1>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="index.html#products" class="nav-link">Products</a>
                <a href="index.html#about" class="nav-link">About</a>
                <a href="index.html#contact" class="nav-link">Contact</a>
            </nav>
        </div>
    </header>

    <!-- Checkout Section -->
    <section class="checkout-page">
        <div class="container">
            <div class="checkout-container">
                <div class="checkout-header">
                    <h1>Checkout ðŸ›’</h1>
                    <p>Almost ready to get your cute crafts!</p>
                    <p style="background: #fff3cd; padding: 1rem; border-radius: 10px; margin: 1rem 0; border-left: 4px solid #ffc107;">
                        <strong>ðŸ“§ After placing your order:</strong> We'll email you at <strong>annassweetcrafts@gmail.com</strong> with payment and delivery options!
                    </p>
                </div>
                
                <div class="checkout-content">
                    <div class="checkout-form">
                        <h2>Shipping Information</h2>
                        <form id="checkoutForm">
                            <div class="form-group">
                                <label for="name">Full Name</label>
                                <input type="text" id="name" name="name" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="address">Address</label>
                                <textarea id="address" name="address" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="city">City</label>
                                <input type="text" id="city" name="city" required>
                            </div>
                            <div class="form-group">
                                <label for="zip">ZIP Code</label>
                                <input type="text" id="zip" name="zip" required>
                            </div>
                        </form>
                    </div>
                    
                    <div class="order-summary">
                        <h2>Order Summary</h2>
                        <div id="orderItems">
                            <!-- Order items will be populated here -->
                        </div>
                        <div class="order-total">
                            Total: $<span id="orderTotal">0.00</span>
                        </div>
                        <button class="place-order-btn" onclick="placeOrder()">
                            Place Order ðŸ’•
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Anna's Sweet Crafts. Made with ðŸ’• for friends everywhere!</p>
        </div>
    </footer>

    <script>
        // Load cart from localStorage
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        // Display order items
        function displayOrderItems() {
            const orderItems = document.getElementById('orderItems');
            const orderTotal = document.getElementById('orderTotal');
            
            if (cart.length === 0) {
                orderItems.innerHTML = '<p>No items in cart</p>';
                return;
            }
            
            orderItems.innerHTML = cart.map(item => {
                let itemDetails = `<strong>${item.name}</strong>`;
                if (item.selectedDesign) {
                    itemDetails += `<br><small>Design: ${item.selectedDesign}</small>`;
                }
                if (item.selectedColor) {
                    itemDetails += `<br><small>Color: ${item.selectedColor}</small>`;
                }
                if (item.personalizedName) {
                    itemDetails += `<br><small>Name: ${item.personalizedName}</small>`;
                }
                itemDetails += `<br><small>Qty: ${item.quantity}</small>`;
                
                return `
                    <div class="order-item">
                        <div>
                            ${itemDetails}
                        </div>
                        <div>$${(item.price * item.quantity).toFixed(2)}</div>
                    </div>
                `;
            }).join('');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            orderTotal.textContent = total.toFixed(2);
        }
        
        // Place order
        function placeOrder() {
            console.log('Place order button clicked!');
            console.log('Cart contents:', cart);
            
            if (cart.length === 0) {
                alert('Your cart is empty! Please add some items first.');
                window.location.href = 'index.html';
                return;
            }
            
            const form = document.getElementById('checkoutForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            console.log('Form is valid, proceeding with order...');
            
            // Collect order data
            const orderData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                zip: document.getElementById('zip').value,
                items: cart.map(item => {
                    let itemDetails = `${item.name}`;
                    if (item.selectedDesign) {
                        itemDetails += ` - Design: ${item.selectedDesign}`;
                    }
                    if (item.selectedColor) {
                        itemDetails += ` - Color: ${item.selectedColor}`;
                    }
                    if (item.personalizedName) {
                        itemDetails += ` - Name: ${item.personalizedName}`;
                    }
                    itemDetails += ` (Qty: ${item.quantity}) - $${(item.price * item.quantity).toFixed(2)}`;
                    return itemDetails;
                }).join('\n'),
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)
            };
            
            // Send email using Formspree (to Anna)
            console.log('Sending order notification email to Anna...');
            fetch('https://formspree.io/f/mvgbngya', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    name: orderData.name,
                    email: orderData.email,
                    phone: orderData.phone,
                    address: orderData.address,
                    city: orderData.city,
                    zip: orderData.zip,
                    message: `New Order from Anna's Sweet Crafts!\n\nItems:\n${orderData.items}\n\nTotal: $${orderData.total}\n\nWe will contact you soon for payment and delivery options! ðŸ’•`
                })
            })
            .then(response => {
                if (response.ok) {
                    console.log('Order notification email sent to Anna successfully!');
                    // Send customer confirmation email
                    sendCustomerConfirmation(orderData);
                    
                    // Clear cart
                    localStorage.removeItem('cart');
                    
                    // Redirect to confirmation page
                    const confirmationUrl = `order-confirmation.html?name=${encodeURIComponent(orderData.name)}&total=${orderData.total}&items=${cart.length}`;
                    console.log('Redirecting to confirmation page:', confirmationUrl);
                    window.location.href = confirmationUrl;
                } else {
                    console.error('Failed to send order notification email');
                    throw new Error('Failed to send order');
                }
            })
            .catch(error => {
                console.error('Error sending order notification:', error);
                // Still send customer confirmation and redirect even if Anna's email fails
                sendCustomerConfirmation(orderData);
                localStorage.removeItem('cart');
                const confirmationUrl = `order-confirmation.html?name=${encodeURIComponent(orderData.name)}&total=${orderData.total}&items=${cart.length}`;
                window.location.href = confirmationUrl;
            });
        }
        
        // Send customer confirmation email
        function sendCustomerConfirmation(orderData) {
            console.log('Sending customer confirmation email...');
            // Send a separate email to the customer
            fetch('https://formspree.io/f/mvgbngya', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    name: orderData.name,
                    email: orderData.email,
                    phone: orderData.phone,
                    address: orderData.address,
                    city: orderData.city,
                    zip: orderData.zip,
                    message: `Order Confirmation - Anna's Sweet Crafts\n\nDear ${orderData.name},\n\nThank you for your order! We're so excited to create these beautiful crafts just for you! ðŸ’•\n\nYour Order Details:\n${orderData.items}\n\nTotal: $${orderData.total}\n\nWhat happens next?\n1. Anna will contact you within 24 hours to discuss payment and delivery options\n2. Once payment is arranged, your handmade crafts will be carefully packaged and shipped\n3. You'll receive tracking information when your order ships\n\nIf you have any questions, please don't hesitate to contact us at annassweetcrafts@gmail.com\n\nThank you for supporting Anna's Sweet Crafts!\n\nWith love,\nAnna ðŸ’•`
                })
            })
            .then(response => {
                if (response.ok) {
                    console.log('Customer confirmation email sent successfully!');
                } else {
                    console.error('Failed to send customer confirmation email');
                }
            })
            .catch(error => {
                console.error('Customer confirmation email failed:', error);
                // Don't show error to customer, just log it
            });
        }
        
        // Initialize checkout page
        document.addEventListener('DOMContentLoaded', function() {
            displayOrderItems();
        });
    </script>
</body>
</html>
